<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LifeLink - Settings</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "Poppins", sans-serif;
        }
        
        :root {
            --primary-color: #d32f2f;
            --secondary-color: #b71c1c;
            --background-color: #f5f7fa;
            --card-color: #ffffff;
            --text-color: #333;
            --text-light: #666;
        }
        
        body {
            background-color: var(--background-color);
            color: var(--text-color);
            padding: 20px;
        }

        .header {
            background-color: white;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            padding: 20px 30px;
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 28px;
            font-weight: 700;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo::before {
            content: "‚ù§Ô∏è";
            font-size: 24px;
        }

        .nav-links {
            display: flex;
            gap: 20px;
        }

        .nav-link {
            text-decoration: none;
            color: var(--text-color);
            font-weight: 500;
            padding: 8px 16px;
            border-radius: 5px;
            transition: all 0.3s;
        }

        .nav-link:hover {
            background-color: var(--primary-color);
            color: white;
        }

        .nav-link.active {
            background-color: var(--primary-color);
            color: white;
        }

        .back-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .back-btn:hover {
            background-color: var(--secondary-color);
        }

        .settings-container {
            max-width: 800px;
            margin: 0 auto;
        }

        .page-title {
            font-size: 32px;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 30px;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .page-title::before {
            content: "‚öôÔ∏è";
            font-size: 28px;
        }

        .settings-card {
            background-color: white;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            padding: 40px;
            margin-bottom: 30px;
        }

        .settings-section {
            margin-bottom: 40px;
            padding-bottom: 30px;
            border-bottom: 2px solid #f0f0f0;
        }

        .settings-section:last-child {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }

        .section-title {
            font-size: 24px;
            font-weight: 600;
            color: var(--text-color);
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-title::before {
            font-size: 20px;
        }

        .profile-settings .section-title::before { content: "üë§"; }
        .notification-settings .section-title::before { content: "üîî"; }
        .privacy-settings .section-title::before { content: "üîí"; }
        .feedback-settings .section-title::before { content: "üí¨"; }

        .settings-form {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .form-label {
            font-weight: 500;
            color: var(--text-color);
        }

        .form-input {
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s;
            background-color: #f9f9f9;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary-color);
            background-color: white;
            box-shadow: 0 0 0 3px rgba(211, 47, 47, 0.1);
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .checkbox-input {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .checkbox-label {
            font-weight: 400;
            color: var(--text-color);
            cursor: pointer;
        }

        .radio-group {
            display: flex;
            gap: 30px;
            margin-bottom: 20px;
        }

        .radio-option {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
        }

        .radio-input {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .radio-label {
            font-weight: 400;
            color: var(--text-color);
        }

        .form-textarea {
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            background-color: #f9f9f9;
            min-height: 150px;
            resize: vertical;
            transition: all 0.3s;
            grid-column: 1 / -1;
        }

        .form-textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            background-color: white;
            box-shadow: 0 0 0 3px rgba(211, 47, 47, 0.1);
        }

        .save-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 10px;
            font-size: 18px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin: 30px auto 0;
            width: 200px;
        }

        .save-btn:hover {
            background-color: var(--secondary-color);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(211, 47, 47, 0.3);
        }

        .message {
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: none;
            text-align: center;
        }

        .message.success {
            background-color: #e8f5e9;
            color: #2e7d32;
            border: 1px solid #c8e6c9;
            display: block;
        }

        .message.error {
            background-color: #ffebee;
            color: #c62828;
            border: 1px solid #ffcdd2;
            display: block;
        }

        .danger-zone {
            background-color: #ffebee;
            border: 2px solid #ffcdd2;
            border-radius: 15px;
            padding: 30px;
            margin-top: 40px;
        }

        .danger-title {
            font-size: 20px;
            font-weight: 600;
            color: #c62828;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .danger-title::before {
            content: "‚ö†Ô∏è";
        }

        .danger-text {
            color: #666;
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .danger-btn {
            background-color: #c62828;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .danger-btn:hover {
            background-color: #b71c1c;
        }

        @media (max-width: 768px) {
            .nav-links {
                display: none;
            }
            
            .header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .settings-form {
                grid-template-columns: 1fr;
            }
            
            .radio-group {
                flex-direction: column;
                gap: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="logo">LifeLink - Settings</div>
        
        <div class="nav-links">
            <a href="in.html" class="nav-link">Dashboard</a>
            <a href="report.html" class="nav-link">Blood Report</a>
            <a href="availability.html" class="nav-link">Blood Availability</a>
            <a href="profile.html" class="nav-link">Profile</a>
            <a href="setting.html" class="nav-link active">Settings</a>
        </div>
        
        <button class="back-btn" onclick="window.location.href='in.html'">
            ‚Üê Back to Dashboard
        </button>
    </div>

    <div class="settings-container">
        <h1 class="page-title">Account Settings</h1>
        
        <div class="message" id="message"></div>

        <div class="settings-card">
            <form id="settingsForm">
                <!-- Profile Settings -->
                <div class="settings-section profile-settings">
                    <h2 class="section-title">Profile Settings</h2>
                    <div class="settings-form">
                        <div class="form-group">
                            <label class="form-label">Full Name</label>
                            <input type="text" class="form-input" id="settingsName" placeholder="Your full name">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Email Address</label>
                            <input type="email" class="form-input" id="settingsEmail" placeholder="Your email address" disabled>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">New Password</label>
                            <input type="password" class="form-input" id="settingsPassword" placeholder="Enter new password">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Confirm Password</label>
                            <input type="password" class="form-input" id="settingsConfirmPassword" placeholder="Confirm new password">
                        </div>
                    </div>
                </div>

                <!-- Notification Settings -->
                <div class="settings-section notification-settings">
                    <h2 class="section-title">Notification Settings</h2>
                    <div class="checkbox-group">
                        <input type="checkbox" class="checkbox-input" id="notifyEmail" checked>
                        <label class="checkbox-label" for="notifyEmail">Email notifications</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" class="checkbox-input" id="notifySMS">
                        <label class="checkbox-label" for="notifySMS">SMS notifications</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" class="checkbox-input" id="notifyDonation" checked>
                        <label class="checkbox-label" for="notifyDonation">Blood donation reminders</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" class="checkbox-input" id="notifyEmergency" checked>
                        <label class="checkbox-label" for="notifyEmergency">Emergency blood requests</label>
                    </div>
                </div>

                <!-- Privacy Settings -->
                <div class="settings-section privacy-settings">
                    <h2 class="section-title">Privacy Settings</h2>
                    <div class="radio-group">
                        <div class="radio-option">
                            <input type="radio" class="radio-input" id="privacyPublic" name="privacy" value="public" checked>
                            <label class="radio-label" for="privacyPublic">Public profile</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" class="radio-input" id="privacyPrivate" name="privacy" value="private">
                            <label class="radio-label" for="privacyPrivate">Private profile</label>
                        </div>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" class="checkbox-input" id="showDonations" checked>
                        <label class="checkbox-label" for="showDonations">Show my donation history publicly</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" class="checkbox-input" id="showLocation">
                        <label class="checkbox-label" for="showLocation">Share my location for nearby requests</label>
                    </div>
                </div>

                <!-- Feedback Section -->
                <div class="settings-section feedback-settings">
                    <h2 class="section-title">Feedback & Support</h2>
                    <div class="form-group">
                        <label class="form-label">Your Feedback</label>
                        <textarea class="form-textarea" id="settingsFeedback" placeholder="Share your feedback, suggestions, or report issues..."></textarea>
                    </div>
                </div>

                <button type="button" class="save-btn" onclick="saveSettings()">
                    üíæ Save All Changes
                </button>
            </form>
        </div>

        <!-- Danger Zone -->
        <div class="danger-zone">
            <h2 class="danger-title">Danger Zone</h2>
            <p class="danger-text">
                These actions are irreversible. Please proceed with caution.
            </p>
            <button class="danger-btn" onclick="deleteAccount()">
                üóëÔ∏è Delete My Account
            </button>
        </div>
    </div>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCl17zNeEBsyCi0SmD83EXWzOMDynu-Ro0",
            authDomain: "blood-and-hospital-finder-main.firebaseapp.com",
            databaseURL: "https://blood-and-hospital-finder-main-default-rtdb.firebaseio.com",
            projectId: "blood-and-hospital-finder-main",
            storageBucket: "blood-and-hospital-finder-main.appspot.com",
            messagingSenderId: "746429696511",
            appId: "1:746429696511:web:2b435c8e0633fe32537fca",
            measurementId: "G-DD0CX3HH6W"
        };

        // Initialize Firebase
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const auth = firebase.auth();
        const database = firebase.database();

        // Show message function
        function showMessage(message, type) {
            const messageEl = document.getElementById('message');
            messageEl.textContent = message;
            messageEl.className = `message ${type}`;
            
            setTimeout(() => {
                messageEl.style.display = 'none';
            }, 5000);
        }

        // Load user settings
        function loadSettings() {
            const user = auth.currentUser;
            
            if (!user) {
                window.location.href = "index.html";
                return;
            }

            // Set email
            document.getElementById('settingsEmail').value = user.email;
            
            // Load user data from Firebase
            database.ref('users/' + user.uid).once('value').then((snapshot) => {
                const userData = snapshot.val();
                
                if (userData) {
                    // Load profile settings
                    document.getElementById('settingsName').value = userData.name || '';
                    
                    // Load notification settings
                    if (userData.notifications) {
                        document.getElementById('notifyEmail').checked = userData.notifications.email || true;
                        document.getElementById('notifySMS').checked = userData.notifications.sms || false;
                        document.getElementById('notifyDonation').checked = userData.notifications.donation || true;
                        document.getElementById('notifyEmergency').checked = userData.notifications.emergency || true;
                    }
                    
                    // Load privacy settings
                    if (userData.privacy) {
                        document.getElementById('privacyPublic').checked = userData.privacy === 'public';
                        document.getElementById('privacyPrivate').checked = userData.privacy === 'private';
                        document.getElementById('showDonations').checked = userData.privacyShowDonations || true;
                        document.getElementById('showLocation').checked = userData.privacyShowLocation || false;
                    }
                    
                    // Load feedback
                    document.getElementById('settingsFeedback').value = userData.feedback || '';
                }
            }).catch((error) => {
                console.error("Error loading settings:", error);
            });
        }

        // Save settings function
        function saveSettings() {
            const user = auth.currentUser;
            if (!user) return;

            // Get form values
            const name = document.getElementById('settingsName').value.trim();
            const password = document.getElementById('settingsPassword').value;
            const confirmPassword = document.getElementById('settingsConfirmPassword').value;
            const feedback = document.getElementById('settingsFeedback').value.trim();

            // Get notification settings
            const notifications = {
                email: document.getElementById('notifyEmail').checked,
                sms: document.getElementById('notifySMS').checked,
                donation: document.getElementById('notifyDonation').checked,
                emergency: document.getElementById('notifyEmergency').checked
            };

            // Get privacy settings
            const privacy = document.querySelector('input[name="privacy"]:checked').value;
            const privacyShowDonations = document.getElementById('showDonations').checked;
            const privacyShowLocation = document.getElementById('showLocation').checked;

            // Validate password
            if (password && password !== confirmPassword) {
                showMessage('Passwords do not match!', 'error');
                return;
            }

            if (password && password.length < 6) {
                showMessage('Password must be at least 6 characters!', 'error');
                return;
            }

            // Prepare settings data
            const settingsData = {
                name: name || '',
                notifications: notifications,
                privacy: privacy,
                privacyShowDonations: privacyShowDonations,
                privacyShowLocation: privacyShowLocation,
                feedback: feedback,
                last_updated: Date.now()
            };

            // Save to Firebase
            database.ref('users/' + user.uid).update(settingsData).then(() => {
                // Update password if provided
                if (password) {
                    user.updatePassword(password).then(() => {
                        showMessage('Settings and password updated successfully!', 'success');
                    }).catch((error) => {
                        console.error("Error updating password:", error);
                        showMessage('Settings saved, but password update failed.', 'error');
                    });
                } else {
                    showMessage('Settings saved successfully!', 'success');
                }
                
                // Update name in authentication if changed
                if (name) {
                    user.updateProfile({
                        displayName: name
                    }).catch((error) => {
                        console.error("Error updating display name:", error);
                    });
                }
            }).catch((error) => {
                console.error("Error saving settings:", error);
                showMessage('Error saving settings: ' + error.message, 'error');
            });
        }

        // Delete account function
        function deleteAccount() {
            if (!confirm('‚ö†Ô∏è Are you absolutely sure? This will permanently delete your account and all your data. This action cannot be undone.')) {
                return;
            }

            const user = auth.currentUser;
            if (!user) return;

            if (!confirm('üö® FINAL WARNING: All your data including donation history, profile information, and settings will be permanently deleted. Are you sure?')) {
                return;
            }

            // First delete from database
            database.ref('users/' + user.uid).remove().then(() => {
                // Then delete authentication account
                user.delete().then(() => {
                    showMessage('Account deleted successfully. Redirecting to login...', 'success');
                    setTimeout(() => {
                        window.location.href = "index.html";
                    }, 2000);
                }).catch((error) => {
                    console.error("Error deleting account:", error);
                    showMessage('Error deleting account: ' + error.message, 'error');
                });
            }).catch((error) => {
                console.error("Error removing user data:", error);
                showMessage('Error deleting account data: ' + error.message, 'error');
            });
        }

        // Load settings on page load
        document.addEventListener('DOMContentLoaded', () => {
            auth.onAuthStateChanged((user) => {
                if (user) {
                    loadSettings();
                } else {
                    window.location.href = "index.html";
                }
            });
        });

        // Password validation
        document.getElementById('settingsPassword').addEventListener('input', (e) => {
            const password = e.target.value;
            const confirmPassword = document.getElementById('settingsConfirmPassword').value;
            
            if (password && password.length < 6) {
                e.target.style.borderColor = '#f44336';
            } else {
                e.target.style.borderColor = '';
                
                if (confirmPassword && password !== confirmPassword) {
                    document.getElementById('settingsConfirmPassword').style.borderColor = '#f44336';
                } else {
                    document.getElementById('settingsConfirmPassword').style.borderColor = '';
                }
            }
        });

        document.getElementById('settingsConfirmPassword').addEventListener('input', (e) => {
            const password = document.getElementById('settingsPassword').value;
            const confirmPassword = e.target.value;
            
            if (password && confirmPassword && password !== confirmPassword) {
                e.target.style.borderColor = '#f44336';
            } else {
                e.target.style.borderColor = '';
            }
        });
    </script>
</body>
</html>
